<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capacity Map</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- Replace YOUR_API_KEY_HERE with your actual Google Maps API key -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7Zn_MdkjojRyTp4QTb0SnZlXzTo_kmA8&callback=initMap">
    </script>

  <script>
    // Hardcoded GeoJSON polygon data
    const geoJsonData = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": {
            "name": "Area 1",
            "id": "1"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [-122.4194, 37.7749],
              [-122.4094, 37.7749],
              [-122.4094, 37.7849],
              [-122.4194, 37.7849],
              [-122.4194, 37.7749]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "name": "Area 2",
            "id": "2"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [-122.4094, 37.7649],
              [-122.3994, 37.7649],
              [-122.3994, 37.7749],
              [-122.4094, 37.7749],
              [-122.4094, 37.7649]
            ]]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "name": "Area 3",
            "id": "3"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [[
              [-122.4294, 37.7649],
              [-122.4194, 37.7649],
              [-122.4194, 37.7749],
              [-122.4294, 37.7749],
              [-122.4294, 37.7649]
            ]]
          }
        }
      ]
    };

    function initMap() {
      // Initialize map centered on San Francisco
      const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 13,
        center: { lat: 37.7749, lng: -122.4194 }
      });

      // Load GeoJSON data onto the map
      map.data.addGeoJson(geoJsonData);

      // Style the polygons
      map.data.setStyle({
        fillColor: '#4285F4',
        fillOpacity: 0.3,
        strokeColor: '#1a73e8',
        strokeWeight: 2
      });

      // Create an InfoWindow for popup display
      const infoWindow = new google.maps.InfoWindow();

      // OPTION 1: Show popup/callout on click
      // Uncomment this block to use popup behavior

      // map.data.addListener('click', function (event) {
      //   const name = event.feature.getProperty('name');
      //   const id = event.feature.getProperty('id');

      //   // Get the click position
      //   const position = event.latLng;

      //   // Set content and position for the InfoWindow
      //   infoWindow.setContent(`
      //     <div style="padding: 10px;">
      //       <h3 style="margin: 0 0 5px 0;">${name}</h3>
      //       <p style="margin: 0;">Territory ID: ${id}</p>
      //     </div>
      //   `);
      //   infoWindow.setPosition(position);
      //   infoWindow.open(map);
      // });


      // OPTION 2: Navigate to anchor link (works with parent page if in iframe)
      // This is currently active
      map.data.addListener('click', function (event) {
        const id = event.feature.getProperty('id');
        const name = event.feature.getProperty('name');

        // Create anchor link from the ID (e.g., #area-1, #area-2, etc.)
        const anchor = `#area-${id}`;

        // If this page is in an iframe, navigate the parent page
        if (window.parent !== window) {
          // In an iframe - update parent URL
          window.parent.location.hash = anchor;
        } else {
          // Not in iframe - navigate this page
          window.location.hash = anchor;
        }

        console.log(`Clicked ${name} - navigating to ${anchor}`);
      });

      // Add hover effect
      map.data.addListener('mouseover', function (event) {
        map.data.overrideStyle(event.feature, {
          fillOpacity: 0.6,
          strokeWeight: 3
        });
      });

      map.data.addListener('mouseout', function (event) {
        map.data.revertStyle();
      });
    }
  </script>
</body>

</html>